# Файлы сертификата Let's Encrypt и их использование при HTTPS

## Местоположение

Основные файлы сертификата находятся в  
`/etc/letsencrypt/live/yourdomain.com/`

## Основные файлы и их назначение

- **privkey.pem** — *Приватный ключ вашего домена*  
  Используется nginx (или другим веб-сервером) для дешифровки данных и цифровой подписи на этапе TLS-рукопожатия. Этот файл должен храниться только на сервере и не передаваться третьим лицам.

- **fullchain.pem** — *Сертификат + цепочка промежуточных CA*  
  Обычно указывается в настройке nginx как `ssl_certificate`. Содержит ваш сертификат и все нужные промежуточные сертификаты для проверки доверия со стороны браузеров.

- **chain.pem** — *Только цепочка промежуточных CA (без вашего сертификата)*  
  Используется, например, для OCSP stapling и расширенной валидации SSL. Может указываться в nginx как `ssl_trusted_certificate` в продвинутых настройках.

- **cert.pem** — *Только сертификат домена (без цепочки CA)*  
  Содержит только публичную часть вашего сертификата. Использовать его отдельно в nginx (`ssl_certificate`) не рекомендуется — многие клиенты не смогут проверить доверие без всей цепочки.

## Как используются при HTTPS-соединении

1. Когда клиент (браузер) заходит на сайт по HTTPS, **nginx отдаёт fullchain.pem** как доказательство подлинности сайта.
2. Клиент проверяет всю цепочку доверия из `fullchain.pem` до корневого центра сертификации.
3. Сервер и браузер договариваются о параметрах шифрования, используя ключи.
4. **privkey.pem** используется только на сервере для криптографических операций, публичная информация из цепочки сертификатов доступна клиенту.
5. После рукопожатия всё дальнейшее общение идёт по защищённому (зашифрованному) каналу.

## Пример конфигурации nginx

```
ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
```

## Кратко

- `privkey.pem`: приватный ключ сервера. Не публикуется и не копируется!
- `fullchain.pem`: вся цепочка сертификатов для клиентов и браузеров. Используется в nginx.
- `chain.pem`: только промежуточные сертификаты, нужен в особых случаях.
- `cert.pem`: только сертификат сайта, отдельно в nginx использовать не нужно.

**Всегда используйте вместе `fullchain.pem` и `privkey.pem` для HTTPS в nginx.**

## Дальнейшее изучение

О том как работает HTTPS можно прочитать [здесь](https://github.com/dmitryst/lot-app/blob/main/docs/how-https-works.md).